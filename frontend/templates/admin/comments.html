{% extends "base.html" %}

{% block title %}Comment Management - Admin{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="admin-header">
        <div class="admin-title">
            <h1>Comment Management</h1>
            <p>Moderate and manage user comments</p>
        </div>
        <div class="admin-actions">
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">← Back to Dashboard</a>
        </div>
    </div>

    <div class="admin-content">
        <div class="content-header">
            <h2>All Comments ({{ comments|length }})</h2>
            <div class="content-filters">
                <input type="text" placeholder="Search comments..." class="search-input" id="commentSearch">
            </div>
        </div>

        {% if comments %}
        <div class="comments-admin-list">
            {% for comment in comments %}
            <div class="comment-admin-item" data-content="{{ comment.content|lower }}" data-username="{{ comment.username|lower }}">
                <div class="comment-admin-header">
                    <div class="comment-user-info">
                        <div class="user-avatar" style="background-color: {{ comment.username | first | upper | hash_color }}">
                            {{ comment.username[0].upper() }}
                        </div>
                        <div class="comment-meta">
                            <span class="comment-author">{{ comment.username }}</span>
                            <span class="comment-timestamp">{{ comment.created_at.strftime('%b %d, %Y at %I:%M %p') }}</span>
                            <span class="comment-id">ID: {{ comment.id }}</span>
                        </div>
                    </div>
                    <div class="comment-actions">
                        <a href="{{ url_for('admin.edit_comment', comment_id=comment.id) }}" class="btn btn-sm btn-primary">Edit</a>
                        <form method="POST" action="{{ url_for('admin.delete_comment', comment_id=comment.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this comment?')">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
                <div class="comment-content">
                    {{ comment.content }}
                </div>
                <div class="comment-admin-footer">
                    <span class="comment-length">{{ comment.content|length }} characters</span>
                    <span class="comment-user-email">{{ comment.email }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">💬</div>
            <h3>No comments found</h3>
            <p>There are no comments to moderate yet.</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Comment search functionality
document.getElementById('commentSearch').addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const commentItems = document.querySelectorAll('.comment-admin-item');

    commentItems.forEach(item => {
        const content = item.dataset.content;
        const username = item.dataset.username;

        if (content.includes(searchTerm) || username.includes(searchTerm)) {
            item.style.display = '';
        } else {
            item.style.display = 'none';
        }
    });
});
</script>
{% endblock %}